{% extends "layouts/backstage_base.html" %}
{% from 'macros/macro.html' import macro %}

{% block title %}
    管理标签
{% endblock %}

{% block script %}
{{ super() }}

    function set_pick(target) {
        target.style.color = 'green'
        target.style.background = 'red'
    }
    function set_nopick(target) {
        target.style.color = 'red';
        target.style.background = 'green';
    }
    tags = new Set();    
    // 事件委托
    function clickp(e) {
        console.log(e)
        var event = e || window.event||arguments.callee.caller;
        
        var target = event.target || event.srcElement;
        if (target.matches('p')) {
            if(tags.has(target.innerText)){
                set_nopick(target)
                tags.delete(target.innerText)
            }else{
                tags.add(target.innerText)
                set_pick(target);
            }
            var del = document.getElementById('tags')
            del.value = [...tags].join(',')
        }
        
    }
    (function(){
        document.getElementById('tag_table').addEventListener('click',clickp);
    })()
{% endblock %}

{% block style %}
    {{ super() }}
    #tags{
        display: none;
    }
{% endblock %}

{% block body%}
    {{ super() }}
    {{ macro.flash_all(form_list.errors.classifys)}}
    {{ macro.flash_all(form_one.errors.classify)}}
{% endblock %}

{% block content %}
<div id='tag_table'>
    {% for x in tags %}
    <p class='tag_lable' >{{ x }}</p>
    {% endfor %}
</div>
<p>删除</p>
<form action="{{ url_for('manage.manage_tags', do='del')}}" method="POST">
    {{ form_list.hidden_tag() }}
    {{ form_list.tags() }}
    {{ form_list.submit() }}
</form>
<p>添加</p>
<form action="{{ url_for('manage.manage_tags', do='add')}}" method="POST">
        {{ form_one.hidden_tag() }}
        {{ form_one.tag() }}
        {{ form_one.submit() }}
    </form>
{% endblock %}